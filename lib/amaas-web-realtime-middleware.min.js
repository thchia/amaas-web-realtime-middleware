!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define("amaas-web-realtime-middleware",[],n):"object"==typeof exports?exports["amaas-web-realtime-middleware"]=n():e["amaas-web-realtime-middleware"]=n()}(this,function(){return function(e){function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}var t={};return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},n.p="",n(n.s=1)}([function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.WS_CONNECT="@@amaas-web-rt-mw/WS_CONNECT",n.WS_DISCONNECT="@@amaas-web-rt-mw/WS_DISCONNECT",n.WS_RECEIVE_MSG="@@amaas-web-rt-mw/RECEIVE_MSG",n.WS_CONNECTED="@@amaas-web-rt-mw/CONNECTED",n.WS_CLOSED="@@amaas-web-rt-mw/CLOSED",n.WS_ERROR="@@amaas-web-rt-mw/ERROR"},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.receiveMessage=n.error=n.disconnect=n.connected=n.connect=n.closed=n.WS_ERROR=n.WS_CLOSED=n.WS_CONNECTED=n.WS_RECEIVE_MSG=n.WS_DISCONNECT=n.WS_CONNECT=void 0;var r=t(0),o=t(2),c=function(e){var n=[],t=function(t,r){var a=Date.now().toString(),i=new e(r);n.push({id:a,conn:i,subCount:0}),i.on("connect",function(){t.dispatch((0,o.connected)()),c(t,r)}),i.on("close",function(){t.dispatch((0,o.closed)())}),i.on("error",function(e){t.dispatch(e(e))}),i.on("message",function(e,n){var r=n.toString();t.dispatch((0,o.receiveMessage)(e,r))})},c=function(e,r){if(0!==r.topics.length){var o=r.topics,c=n.length-1,a=n[c].subCount,i=50-a;if(n&&n.length>0){if(o.slice(0,i).map(function(e){n[c].conn.subscribe(e)}),n[c].subCount=a+o.slice(0,i).length,o.slice(i-1,50).length>0){var s=r.topics.slice(i);r.topics=s,t(e,r)}}else console.error("Cannot subscribe as there is no WS instance open")}};return function(e){return function(o){return function(c){switch(c.type){case r.WS_CONNECT:var a=c.payload;return t(e,a),o(c);case r.WS_DISCONNECT:return n&&n.length>0&&(n.map(function(e){e.conn.end()}),n=[]),o(c);default:return o(c)}}}}};n.default=c,n.WS_CONNECT=r.WS_CONNECT,n.WS_DISCONNECT=r.WS_DISCONNECT,n.WS_RECEIVE_MSG=r.WS_RECEIVE_MSG,n.WS_CONNECTED=r.WS_CONNECTED,n.WS_CLOSED=r.WS_CLOSED,n.WS_ERROR=r.WS_ERROR,n.closed=o.closed,n.connect=o.connect,n.connected=o.connected,n.disconnect=o.disconnect,n.error=o.error,n.receiveMessage=o.receiveMessage},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.disconnect=n.error=n.closed=n.connected=n.receiveMessage=n.connect=void 0;var r=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},o=t(0),c=function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[t]=e[t]);return n.default=e,n}(o);n.connect=function(e){return{type:c.WS_CONNECT,payload:r({},e)}},n.receiveMessage=function(e,n){return{type:c.WS_RECEIVE_MSG,payload:{topic:e,message:n}}},n.connected=function(){return{type:c.WS_RECEIVE_MSG}},n.closed=function(){return{type:c.WS_CLOSED}},n.error=function(e){return{type:c.WS_ERROR,payload:{error:e}}},n.disconnect=function(){return{type:c.WS_DISCONNECT}}}])});